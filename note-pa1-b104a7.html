<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Note PA1&nbsp;|&nbsp;dreamking60’s blog</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Note PA1">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📓&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="rust-hypervisor-4643d2.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📘&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>Rust Hypervisor</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="sicp-js-73bc46.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🔖&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>SICP JS</span>
        </div>
      </a>
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="-c44b33.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📚&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>考研复习</span>
        </div>
      </a>
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="c-develop-in-linux-1b298b.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;⚒️&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>C develop in Linux</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about-me-da8649.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🎣&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About me</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="university-catalog-b866fe.html">
        <div class="Navbar__Btn">
          
          <span>University Catalog</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📓&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">Note PA1</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Sun, Oct 30, 2022</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--green">
            <a href="tag/Operating System.html">Operating System</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--pink">
            <a href="tag/NJU-PA.html">NJU-PA</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/b104a7fec6724251bba0afee0653f55a" class="PageRoot"><h2 id="https://www.notion.so/152a9b8c69aa43efae9d8d287240090a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/152a9b8c69aa43efae9d8d287240090a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">提高make的效率</span></span></h2><div id="https://www.notion.so/f345ce6e81ed4813ba87d53d450a2861" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">make默认使用单线程进行编译，如果想要加快编译的效率，可以使用如下指令，其中“?”指代创建多少个线程进行执行。如果不知道自己的电脑有几个核可以使用lscpu指令进行查看。</span></span></p></div><pre id="https://www.notion.so/e25af411ba704c9596d00047ef5af724" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>make -j? [Option]</span></span></span></code></pre><div id="https://www.notion.so/b1372847140342e0b1d966a4a484db9b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">为了查看编译加速的效果，你可以在编译的命令前面添加</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">time</code></span><span class="SemanticString">命令，它将会对紧跟在其后的命令的执行时间进行统计, 你只需要关注</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">total</code></span><span class="SemanticString">一栏的时间即可。你可以通过</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">make clean</code></span><span class="SemanticString">清除所有的编译结果, 然后重新编译并统计时间，对比单线程编译和多线程编译的编译时间；你也可以尝试不同的线程数量进行编译，并对比加速比。</span></span></p></div><div id="https://www.notion.so/21533d44df7b4d29ae5876c098a65db3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/600b9ab1bb4d4687b3f0ec9f29ebc2a1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">除了make本身外，还可以使用ccache这个工具加快编译。ccache即compiler cache，它能够为之前的编译提供缓存，再进行新的一次编译时，如果源文件没有发生改变，那么便会使用缓存过的编译生成文件跳过了中间很多的编译流程，来达到提高速度的效果。</span></span></p></div><div id="https://www.notion.so/4167a76e8ad84e699cd5bbbbfaa5238a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">配置ccache，实际上是把gcc和g++链接到ccache中的相应可执行文件，这样便能再编译时实现缓存。</span></span></p></div><pre id="https://www.notion.so/8f8093b0ae7040e6a69074c3ed1c69d5" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>export PATH=/usr/lib/ccache:$PATH</span></span></span></code></pre><h2 id="https://www.notion.so/6bf274583236469381109e89c0989bf3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/6bf274583236469381109e89c0989bf3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">编程模型</span></span></h2><div id="https://www.notion.so/61a68cc67c654e95bcb6deb752d47c4b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">编程模型主要是方法和思想。</span></span></p></div><h2 id="https://www.notion.so/af1395478eae442c82d9c294e8d59b8f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/af1395478eae442c82d9c294e8d59b8f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">图灵机</span></span></h2><div id="https://www.notion.so/da7a54820578442590b7572a801fb45c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">程序存放在</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">存储器</strong></span></span><span class="SemanticString">中。</span></span></p></div><div id="https://www.notion.so/3d1407c30a0c496d8792acf822be07ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">CPU</strong></em></span></span><span class="SemanticString">执行程序。</span></span></p></div><div id="https://www.notion.so/12939e320d334d55aa0008c4f177b3b0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">存储器大但是读写效率慢，因此CPU中设计了</span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">寄存器</strong></span></span><span class="SemanticString">用于存储数据，寄存器存储容量小但读写效率高。</span></span></p></div><div id="https://www.notion.so/6e66a870c9c64514b0f06ca610676678" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">指令</strong></span><span class="SemanticString">被设计用于控制CPU对数据的处理。</span></span></p></div><div id="https://www.notion.so/d9adf90ff83449ee94457627e2718e12" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">通过</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">P</strong></span><span class="SemanticString">rogram </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">C</strong></span><span class="SemanticString">ounter(</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">PC</strong></span><span class="SemanticString">)，实现了计算机的自动执行。</span></span></p></div><pre id="https://www.notion.so/34bd147c1ee54b75967b836afd18494c" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">//最简单的计算机只需要做3件事情</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//1.从PC指示的存储器位置取出指令；</span>
	<span class="token comment">//2.执行指令；</span>
	<span class="token comment">//3.更新PC</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/fb0ebfb4115748d1bdefae991f0d1e89" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">一个简单的指令序列，会在pc5处陷入死循环，实际上到这里之后，程序会终止。</span></span></p></div><pre id="https://www.notion.so/14b3495acfd5463b81df92afa47760e8" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">// PC: instruction    | // label: statement</span>
<span class="token number">0</span><span class="token operator">:</span> mov  r1<span class="token punctuation">,</span> <span class="token number">0</span>         <span class="token operator">|</span>  pc0<span class="token operator">:</span> r1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token number">1</span><span class="token operator">:</span> mov  r2<span class="token punctuation">,</span> <span class="token number">0</span>         <span class="token operator">|</span>  pc1<span class="token operator">:</span> r2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token number">2</span><span class="token operator">:</span> addi r2<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token number">1</span>     <span class="token operator">|</span>  pc2<span class="token operator">:</span> r2 <span class="token operator">=</span> r2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">3</span><span class="token operator">:</span> add  r1<span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2    <span class="token operator">|</span>  pc3<span class="token operator">:</span> r1 <span class="token operator">=</span> r1 <span class="token operator">+</span> r2<span class="token punctuation">;</span>
<span class="token number">4</span><span class="token operator">:</span> blt  r2<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2</span>    <span class="token operator">|</span>  pc4<span class="token operator">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>r2 <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">goto</span> pc2<span class="token punctuation">;</span>   <span class="token comment">// branch if less than</span>
<span class="token number">5</span><span class="token operator">:</span> jmp <span class="token number">5</span>              <span class="token operator">|</span>  pc5<span class="token operator">:</span> <span class="token keyword">goto</span> pc5<span class="token punctuation">;</span></span></span></span></code></pre><div id="https://www.notion.so/a23ac707b3074f4a9bd00439725e39eb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">这个最简单的计算机被称为图灵机（Turing machine）。</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/2f21c10f1caf4bdf851adb125b5fdb65" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">结构上，TM有存储器，PC，寄存器，加法器</span></span></li><li id="https://www.notion.so/a675ecbee3c041739f80c1b50b574d49" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">工作方式上，TM不断地重复如下流程：从PC指示的存储器位置取出指令，执行指令，然后更新PC。</span></span></li></ul><div id="https://www.notion.so/a951fe63ec3a4c7da6af35bd2e6d8d4d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">计算机是一个数组逻辑电路，可以划分成两部分，一部分由所有时序逻辑部件 （存储器·，计数器，寄存器）构成，另一部分则是剩余的组合逻辑部件（如加法器等）。</span></span></p></div><h2 id="https://www.notion.so/d30c505de49b47a1802d02e638488eb9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/d30c505de49b47a1802d02e638488eb9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">状态机</span></span></h2><div id="https://www.notion.so/f56d3d3fb74543d99f931fda7b310f62" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">把计算机看成状态机，指令是计算机进行以此状态转移的输入激励。</span></span></p></div><div id="https://www.notion.so/3f32d0970fe34777880227ace884fc92" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">程序也可以看成一个状态机。程序放到计算机的内存中，相当于状态转移图中指定了一个初始状态，程序运行的过程从这个初始状态开始，每执行完一条指令，就会进行以此确定的状态转移。</span></span></p></div><h2 id="https://www.notion.so/bee0a4ce2f3c47578a798025370df8f5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/bee0a4ce2f3c47578a798025370df8f5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Monitor初始化</span></span></h2><div id="https://www.notion.so/2cc1904843bd46d18b318e5f165ee2cb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Nemu运行的时候，首先会调用</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">init_monitor()</mark></span><span class="SemanticString">函数，进行一些和monitor相关的初始化工作。</span></span></p></div><pre id="https://www.notion.so/17546e26220d4f50881b0311d511e553" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">void</span> <span class="token function">init_monitor</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* Perform some global initialization. */</span>

  <span class="token comment">/* Parse arguments. */</span>
  <span class="token function">parse_args</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Set random seed. */</span>
  <span class="token function">init_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Open the log file. */</span>
  <span class="token function">init_log</span><span class="token punctuation">(</span>log_file<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Initialize memory. */</span>
  <span class="token function">init_mem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Initialize devices. */</span>
  <span class="token function">IFDEF</span><span class="token punctuation">(</span>CONFIG_DEVICE<span class="token punctuation">,</span> <span class="token function">init_device</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Perform ISA dependent initialization. */</span>
  <span class="token function">init_isa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Load the image to memory. This will overwrite the built-in image. */</span>
  <span class="token keyword">long</span> img_size <span class="token operator">=</span> <span class="token function">load_img</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Initialize differential testing. */</span>
  <span class="token function">init_difftest</span><span class="token punctuation">(</span>diff_so_file<span class="token punctuation">,</span> img_size<span class="token punctuation">,</span> difftest_port<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Initialize the simple debugger. */</span>
  <span class="token function">init_sdb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">IFDEF</span><span class="token punctuation">(</span>CONFIG_ITRACE<span class="token punctuation">,</span> <span class="token function">init_disasm</span><span class="token punctuation">(</span>
    <span class="token function">MUXDEF</span><span class="token punctuation">(</span>CONFIG_ISA_x86<span class="token punctuation">,</span>     <span class="token string">"i686"</span><span class="token punctuation">,</span>
    <span class="token function">MUXDEF</span><span class="token punctuation">(</span>CONFIG_ISA_mips32<span class="token punctuation">,</span>  <span class="token string">"mipsel"</span><span class="token punctuation">,</span>
    <span class="token function">MUXDEF</span><span class="token punctuation">(</span>CONFIG_ISA_riscv32<span class="token punctuation">,</span> <span class="token string">"riscv32"</span><span class="token punctuation">,</span>
    <span class="token function">MUXDEF</span><span class="token punctuation">(</span>CONFIG_ISA_riscv64<span class="token punctuation">,</span> <span class="token string">"riscv64"</span><span class="token punctuation">,</span> <span class="token string">"bad"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">"-pc-linux-gnu"</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Display welcome message. */</span>
  <span class="token function">welcome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/9a7691893328400a90a33c3fda8f00ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">parse_args()解析传入的参数。</span></span></p></div><div id="https://www.notion.so/6bccde239d064b98b91aef9b9ad3f5d0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">init_rand()设置随机数的种子。</span></span></p></div><div id="https://www.notion.so/c9575d8c611a4fc5aab3826fdea03a68" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">init_log()设置log信息相关内容，如果没有log file，log信息会直接输出在stdout上，如果有log file，便会输出到log_file中。</span></span></p></div><pre id="https://www.notion.so/c78d56cce386477b87011be2f2341a85" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PG_ALIGN</span> <span class="token expression"><span class="token function">__attribute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">aligned</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </span><span class="token comment">//以4096个字节进行数据对齐</span></span>
<span class="token keyword">static</span> <span class="token class-name">uint8_t</span> pmem<span class="token punctuation">[</span>CONFIG_MSIZE<span class="token punctuation">]</span> PG_ALIGN <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> </span></span></span></code></pre><div id="https://www.notion.so/8e8bf17c0bfa4e6b8120b0d4b004caad" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">init_mem()初始化Nemu的内存，默认配置为0x8000000Byte=128MB。</span></span></p></div><pre id="https://www.notion.so/3f734ab50e3543c48f686da120a35628" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">void</span> <span class="token function">init_isa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* Load built-in image. */</span>
  <span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token function">guest_to_host</span><span class="token punctuation">(</span>RESET_VECTOR<span class="token punctuation">)</span><span class="token punctuation">,</span> img<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Initialize this virtual computer system. */</span>
  <span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/78ca77113573472bb7f09f31e5a72e29" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">init_isa()做两件事情，一是将客户程序读入到一个固定的内存位置</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">RESET_VECTOR</mark></span><span class="SemanticString">，二是初始化寄存器，分别对应</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">memcpy()</mark></span><span class="SemanticString">和</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">restart()</mark></span><span class="SemanticString">两个方法，其中初始化寄存器时会将PC寄存器的值设为</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">RESET_VECTOR</mark></span><span class="SemanticString">即客户程序的内存地址，如此便能实现开始时运行。</span></span></p></div><div id="https://www.notion.so/7023736102ce402ebab09c58cfe73327" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">load_img()</code></span><span class="SemanticString">函数 (在</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">nemu/src/monitor/monitor.c</code></span><span class="SemanticString">中定义). 这个函数会将一个有意义的客户程序从</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://en.wikipedia.org/wiki/Disk_image">镜像文件</a></span><span class="SemanticString">读入到内存, 覆盖刚才的内置客户程序. 这个镜像文件是运行NEMU的一个可选参数, 在运行NEMU的命令中指定. 如果运行NEMU的时候没有给出这个参数, NEMU将会运行内置客户程序.</span></span></p></div><h2 id="https://www.notion.so/c0cd7cec6fbc448aabfe6856ebb0ab2c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/c0cd7cec6fbc448aabfe6856ebb0ab2c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">优雅地退出</span></span></h2><div id="https://www.notion.so/5e7f6d3dff3c42c8975f547eb6e36d20" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">直接输入“q”发生错误的原因在于</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">NEMU_STATE</mark></span><span class="SemanticString">的状态出现错误，由于</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">cmd_q()</mark></span><span class="SemanticString"> 执行退出，因此可以在执行退出时重设程序的运行状态为</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">NEMU_QUIT</mark></span><span class="SemanticString">。</span></span></p></div><pre id="https://www.notion.so/4dae4d1beda742088c376770010d04ba" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">cmd_q</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  nemu_state<span class="token punctuation">.</span>state <span class="token operator">=</span> NEMU_QUIT<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><h2 id="https://www.notion.so/b41836ec2b5e4f9ab874e8013757e383" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b41836ec2b5e4f9ab874e8013757e383"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Problem</span></span></h2><blockquote id="https://www.notion.so/e7bf2c2a949e48febf739b64f39cb4f5" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">在程序设计课上老师告诉你, 当程序执行到</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">main()</code></span><span class="SemanticString">函数返回处的时候, 程序就退出了, 你对此深信不疑. 但你是否怀疑过, 凭什么程序执行到</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">main()</code></span><span class="SemanticString">函数的返回处就结束了? 如果有人告诉你, 程序设计课上老师的说法是错的, 你有办法来证明/反驳吗? 如果你对此感兴趣, 请在互联网上搜索相关内容.</span></span></blockquote><div id="https://www.notion.so/43ad5741d5384454af2cd62f96716651" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><blockquote id="https://www.notion.so/fad8f9eb2a9147daa2db7638138db19c" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">对于GNU/Linux上的一个程序, 怎么样才算开始? 怎么样才算是结束? 对于在NEMU中运行的程序, 问题的答案又是什么呢?</span></span><div id="https://www.notion.so/4c18b9e300634f0ba0816df6c310115d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">与此相关的问题还有: NEMU中为什么要有</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">nemu_trap</code></span><span class="SemanticString">? 为什么要有monitor?</span></span></p></div></blockquote><h2 id="https://www.notion.so/7ae817e591b44765bfe6b4643f302654" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/7ae817e591b44765bfe6b4643f302654"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">简易调试器</span></span></h2><div id="https://www.notion.so/4236dbb033db49c3916b24ea7d2d1f23" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">readline()</mark></span><span class="SemanticString">函数从键盘上读入命令，与</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">gets()</mark></mark></mark></mark></mark></mark></span><span class="SemanticString">相比，</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">readline()</mark></span><span class="SemanticString">提供“行编辑”功能，可以通过上、下方向键翻阅历史记录，</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">shell</mark></span><span class="SemanticString">程序就是通过</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">readline()</mark></span><span class="SemanticString">读入命令的。</span></span></p></div><pre id="https://www.notion.so/7702637a5eb643d5a6b8d84e632bbb16" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">//The prompt prints some tips.</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">readline</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>prompt<span class="token punctuation">)</span><span class="token punctuation">;</span> </span></span></span></code></pre><div id="https://www.notion.so/b5f7644f509f487591d4b66fcbada590" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">strtok()</mark></span><span class="SemanticString">函数用于按一定的规则分割字符串，并返回第一个符合条件的字符串。</span></span></p></div><pre id="https://www.notion.so/a0ba837d2031493cb78bbd3575d7be99" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">//str is the string to split; delim is the rule of spliting</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strtok</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>delim<span class="token punctuation">)</span><span class="token punctuation">;</span> </span></span></span></code></pre><h3 id="https://www.notion.so/65a570a367b54362b2579aa8a05f3750" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/65a570a367b54362b2579aa8a05f3750"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">单步执行</span></span></h3><div id="https://www.notion.so/72c13124360b4e61bb101dc71c37e953" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgGray">cpu_exec()</mark></span><span class="SemanticString">接口可以直接使用。</span></span></p></div><pre id="https://www.notion.so/f8f5241751f74774a71a90d01e61efbb" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">cmd_si</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//default: run one instruction</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>args <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cpu_exec</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//Get the arguments</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>arg <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> steps <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//Too Many arguments</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Too many arguments!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//Check the arguments</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>steps <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> steps <span class="token operator">>=</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Too big steps for si! Not Reconmend!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//Argsment: run n instructions</span>
  <span class="token function">cpu_exec</span><span class="token punctuation">(</span>steps<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><h3 id="https://www.notion.so/c3cb062545a744c2bdb7da3db857e50e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/c3cb062545a744c2bdb7da3db857e50e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">打印寄存器</span></span></h3><blockquote id="https://www.notion.so/383771bd526946a6afb3190ed05915f9" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">格式化字符串规则：                                                                                           %s 输出字符串                                                                                                  %x 输出16进制数                                                                                                  %d 输出10进制数                                                                                              %[number][format] 靠右输出，左边填充空格使输出满足number个字节位     %-[number][format] 靠左输出，右边填充空格使输出满足number个字节位</span></span></blockquote><pre id="https://www.notion.so/317329e358d74fefb5d2f57ad691d95a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">// isa/riscv32/reg.c</span>
<span class="token keyword">void</span> <span class="token function">isa_reg_display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%-5s 0x%-9x %-d\n"</span><span class="token punctuation">,</span> regs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">gpr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">gpr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// monitor/sdb/sdb.c</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">cmd_info</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//No arguments</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>args <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Without arguments! Input \"info r\" for info the register message!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//Get the argument</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>arg <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">//Too Many arguments</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Too many arguments!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//Check the argument</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>arg<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">isa_reg_display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Invalid info arguments!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/ca6970a03b624e1ea5a696db37ce1dc1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></article>
  <footer class="Footer">
  <div>&copy; dreamking60’s blog 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>